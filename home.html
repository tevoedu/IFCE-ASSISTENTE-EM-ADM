<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calend√°rio de Estudos ¬∑ Colmeia</title>
<!-- Font Awesome (mantido) -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<!-- Google Fonts (Inter + op√ß√£o geom√©trica) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300..700&display=swap" rel="stylesheet">
<!-- Chart.js (mantido) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ===== VARI√ÅVEIS - TEMA ESCURO COLMEIA ===== */
:root {
  --bg-deep: #0c0b0e;
  --bg-panel: #161318;
  --bg-card: #1e1a24;
  --bg-elevated: #2a2332;
  --border-soft: #3a2e44;
  --gold-primary: #e8b35c;
  --gold-deep: #c9902c;
  --gold-glow: rgba(232, 179, 92, 0.3);
  --amber-light: #f3d9a4;
  --text-light: #f5ede8;
  --text-soft: #cfc5d4;
  --text-muted: #9a8ca5;
  --shadow-strong: 0 12px 30px -8px rgba(0, 0, 0, 0.8);
  --shadow-glow: 0 4px 16px rgba(232, 179, 92, 0.2);
  --hex-bg: rgba(232, 179, 92, 0.02);
  --danger: #cf6679;
  --danger-glow: rgba(207, 102, 121, 0.25);
  --warning: #f5b342;
  
  /* Mantendo nomes funcionais */
  --primary: var(--gold-primary);
  --primary-light: var(--amber-light);
  --primary-glow: var(--gold-glow);
  --secondary: #bc9b5a;   /* tom dourado mais s√≥brio */
  --secondary-light: #dbb26b;
  --secondary-glow: rgba(188, 155, 90, 0.25);
  --bg: var(--bg-deep);
  --bg-light: var(--bg-panel);
  --bg-lighter: var(--bg-card);
  --bg-glass: rgba(22, 19, 24, 0.8);
  --bg-glass-light: rgba(42, 35, 50, 0.5);
  --text: var(--text-light);
  --text-secondary: var(--text-soft);
  --gradient-primary: linear-gradient(145deg, #e8b35c, #c27e2e);
  --gradient-secondary: linear-gradient(145deg, #bc9b5a, #9e7c48);
  --danger: #cf6679;
  --danger-glow: rgba(207, 102, 121, 0.3);
  --warning: #f5b342;
  --warning-glow: rgba(245, 179, 66, 0.3);
  --chart-color-1: #e8b35c;
  --chart-color-2: #bc9b5a;
  --chart-color-3: #d4a373;
  --chart-color-4: #c27e2e;
  --chart-color-5: #9e7c48;
  --shadow: 0 8px 20px -6px rgba(0,0,0,0.7);
  --shadow-lg: 0 18px 32px -10px black;
  --shadow-inner: inset 0 2px 4px rgba(0,0,0,0.4);
  --border-radius: 20px;
  --border-radius-sm: 14px;
  --slider-handle-size: 26px;
  --dashboard-width: 300px;
  --transition: all 0.25s cubic-bezier(0.5, 0, 0.2, 1);
}

/* Light theme desativado (mantemos s√≥ dark) */
.light-theme {
  display: none; /* n√£o usado, mas preserva a classe */
}

/* ===== FUNDO COM PADR√ÉO HEXAGONAL SUTIL ===== */
body {
  background: #0c0b0e;
  background-image: 
    radial-gradient(circle at 30% 40%, rgba(232, 179, 92, 0.02) 0%, transparent 25%),
    repeating-linear-gradient(45deg, 
      rgba(232, 179, 92, 0.01) 0px, 
      rgba(232, 179, 92, 0.01) 2px,
      transparent 2px,
      transparent 8px);
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  color: var(--text);
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  line-height: 1.5;
  transition: none; /* sem transi√ß√£o de tema */
  position: relative;
}

/* Efeito de favo de mel no fundo (hex√°gonos) */
body::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.03" width="80" height="80"><path d="M50 0 L67 12 L67 37 L50 49 L33 37 L33 12 L50 0 Z M84 25 L101 37 L101 62 L84 74 L67 62 L67 37 L84 25 Z M16 25 L33 37 L33 62 L16 74 L-1 62 L-1 37 L16 25 Z M50 50 L67 62 L67 87 L50 99 L33 87 L33 62 L50 50 Z" fill="%23e8b35c"/></svg>');
  background-repeat: repeat;
  z-index: -1;
}

/* ===== LAYOUT PRINCIPAL ===== */
.container {
  display: grid;
  grid-template-columns: 1fr var(--dashboard-width);
  gap: 25px;
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  z-index: 2;
}

/* ===== BOT√ïES FLUTUANTES (MANTIDOS) ===== */
.theme-toggle {
  display: none; /* tema fixo escuro, escondemos mas preservamos */
}

.metrics-button {
  position: fixed;
  bottom: 30px;
  left: 30px;
  background: var(--bg-card);
  border: 1px solid var(--gold-primary);
  color: var(--gold-primary);
  padding: 14px 28px;
  border-radius: 60px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  backdrop-filter: blur(8px);
  box-shadow: var(--shadow), 0 0 0 1px rgba(232, 179, 92, 0.2);
  transition: var(--transition);
  z-index: 9999;
}

.metrics-button i {
  font-size: 1.2rem;
}

.metrics-button:hover {
  background: var(--bg-elevated);
  border-color: var(--amber-light);
  color: var(--amber-light);
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg), 0 0 20px var(--gold-glow);
}

/* ===== CALEND√ÅRIO COM FORMATO FAVO ===== */
.calendar {
  background: var(--bg-glass);
  backdrop-filter: blur(16px);
  border-radius: var(--border-radius);
  padding: 24px;
  box-shadow: var(--shadow-lg), 0 0 0 1px rgba(232, 179, 92, 0.1);
  border: none;
  transition: var(--transition);
}

.calendar:hover {
  box-shadow: var(--shadow-lg), 0 0 0 1px rgba(232, 179, 92, 0.3);
}

.calendar-header {
  background: var(--bg-elevated);
  padding: 16px 20px;
  border-radius: 60px;
  margin-bottom: 28px;
  border: 1px solid #3e314b;
  box-shadow: var(--shadow);
}

.calendar-header button {
  background: transparent;
  border: 1px solid #5e4b6b;
  color: var(--gold-primary);
  font-size: 20px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
}

.calendar-header button:hover {
  background: var(--gold-primary);
  color: #161318;
  border-color: var(--gold-primary);
  transform: scale(1.08);
  box-shadow: 0 0 18px var(--gold-glow);
}

.calendar-header h2 {
  font-weight: 600;
  letter-spacing: 0.5px;
  color: var(--amber-light);
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
}

.calendar-grid .day {
  color: #bbaec7;
  font-weight: 500;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 10px 0;
  text-align: center;
}

/* Formato hexagonal para as c√©lulas de data */
.calendar-grid .date {
  aspect-ratio: 0.95 / 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--bg-card);
  cursor: pointer;
  border-radius: 0;
  clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
  transition: var(--transition);
  border: 1px solid #4c3d57;
  font-weight: 500;
  color: var(--text-soft);
  box-shadow: 0 4px 6px rgba(0,0,0,0.6);
  position: relative;
}

.calendar-grid .date:hover {
  background: var(--bg-elevated);
  border-color: var(--gold-primary);
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 12px 16px -8px black, 0 0 0 2px rgba(232, 179, 92, 0.4);
  z-index: 5;
}

.calendar-grid .today {
  background: linear-gradient(145deg, #352e3f, #2a2332);
  border: 2px solid var(--gold-primary);
  color: white;
  font-weight: 700;
  box-shadow: 0 0 18px var(--gold-glow);
}

.task-dot {
  width: 6px;
  height: 6px;
  background: var(--gold-primary);
  border-radius: 50%;
  margin-top: 2px;
  box-shadow: 0 0 6px #e8b35c;
  position: absolute;
  bottom: 12px;
}

/* ===== MODAL DO DIA (MANTIDA ESTRUTURA) ===== */
.day-details {
  background: var(--bg-glass);
  backdrop-filter: blur(30px);
  border: 1px solid #5b4868;
  box-shadow: var(--shadow-lg), 0 0 0 1px #876b4f;
  border-radius: 32px;
}

.day-details-header {
  background: linear-gradient(145deg, #2b2233, #1d1725);
  border-bottom: 1px solid #684f3c;
  border-radius: 32px 32px 0 0;
}

.close-details {
  background: #372e41;
  color: #e1cba6;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

.close-details:hover {
  background: #684f3c;
  color: white;
  transform: rotate(90deg);
}

/* ===== CARDS DE ESTUDO E FORMUL√ÅRIOS ===== */
.study-tracker, .metric-card, .modal-content, .summary-card, .chart-container-large, .metrics-table-container, .goal-card {
  background: var(--bg-panel);
  border: 1px solid #443b4e;
  box-shadow: var(--shadow);
  border-radius: 24px;
  backdrop-filter: none;
}

.study-tracker {
  background: var(--bg-card);
  border: 1px solid #56465f;
}

.study-input, .subject-select, .task-input, .exam-form-input, .exam-form-textarea, .custom-time input {
  background: #201d28;
  border: 1px solid #4d3e58;
  color: var(--text);
  border-radius: 40px;
  padding: 14px 18px;
  transition: var(--transition);
}

.study-input:focus, .subject-select:focus, .task-input:focus, .exam-form-input:focus, .exam-form-textarea:focus {
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 3px rgba(232, 179, 92, 0.2);
  outline: none;
}

.time-controls-container {
  background: #1d1725;
  border-radius: 32px;
  padding: 24px;
  border: 1px solid #5a4a61;
}

.slider-header .slider-value {
  color: var(--gold-primary);
  font-weight: 600;
}

.time-slider {
  background: #342e3c;
  height: 8px;
  border-radius: 10px;
}

.time-slider::-webkit-slider-thumb {
  background: var(--gold-primary);
  width: 26px;
  height: 26px;
  box-shadow: 0 0 12px #e8b35c;
  border: 2px solid white;
}

.time-buttons {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.time-btn {
  background: #282230;
  border: 1px solid #5d4d63;
  color: #cfc5d4;
  border-radius: 40px;
  padding: 8px 16px;
  font-weight: 500;
  transition: var(--transition);
}

.time-btn:hover, .time-btn.active {
  background: var(--gold-primary);
  border-color: var(--gold-primary);
  color: #161318;
  box-shadow: 0 4px 12px var(--gold-glow);
}

.add-btn {
  background: linear-gradient(145deg, #e8b35c, #b37b38);
  border: none;
  color: #0c0b0e;
  font-weight: 600;
  padding: 12px 24px;
  border-radius: 40px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.6);
  transition: var(--transition);
}

.add-btn:hover {
  background: #f0c27b;
  transform: translateY(-2px);
  box-shadow: 0 10px 18px #b8863d;
}

.session-list {
  background: #1b1721;
  border-radius: 20px;
  padding: 8px;
}

.session-item {
  background: #282230;
  border-radius: 40px;
  border: 1px solid #4e3f57;
  margin: 6px 0;
  padding: 12px 16px;
}

.time-total {
  background: #1d1725;
  border-radius: 40px;
  padding: 12px 18px;
  border: 1px solid #5e5066;
}

.progress-bar {
  background: #2f2838;
  border-radius: 20px;
  height: 12px;
}

.progress-fill {
  background: linear-gradient(90deg, #e8b35c, #d4a15a);
  border-radius: 20px;
}

/* ===== CATEGORIAS (QUEST√ïES, AULAS, ETC) ===== */
.category h3 {
  color: var(--amber-light);
  font-weight: 500;
  border-left: 4px solid var(--gold-primary);
  padding-left: 16px;
}

.tasks-list .task-item {
  background: #1e1a24;
  border-radius: 40px;
  border: 1px solid #504157;
}

.task-btn {
  background: transparent;
  color: #afa2bb;
}

.task-btn.complete:hover {
  color: var(--gold-primary);
  background: rgba(232, 179, 92, 0.15);
}

/* ===== DASHBOARD SIDEBAR ===== */
.dashboard-sidebar {
  background: var(--bg-glass);
  backdrop-filter: blur(16px);
  border: 1px solid #584a62;
  border-radius: 32px;
  padding: 20px;
}

.metric-card {
  background: rgba(22, 19, 24, 0.8);
  border: 1px solid #65526b;
  border-radius: 28px;
  padding: 20px;
}

.metric-icon {
  background: #2b2330;
  color: var(--gold-primary);
  border: 1px solid #7a657f;
}

.days-container .day-item .metric-value {
  color: var(--gold-primary);
}

/* ===== MODAIS ===== */
.modal-content {
  border-radius: 40px;
  border: 1px solid #a47a55;
  background: #1a1620;
  box-shadow: 0 30px 50px rgba(0,0,0,0.9);
}

.modal-header h2 {
  color: var(--gold-primary);
}

.close-modal {
  background: #302a38;
  color: #e8b35c;
}

.subject-list-item {
  background: #231e2a;
  border-radius: 50px;
  border: 1px solid #5c4863;
}

.subject-action-btn {
  color: #bbaec7;
}

.subject-action-btn.use:hover {
  color: var(--gold-primary);
}

.subject-action-btn.delete:hover {
  color: var(--danger);
}

/* ===== BOT√ïES DE EXPORT/IMPORT ===== */
.study-data-buttons {
  bottom: 30px;
  right: 30px;
}

.study-data-btn {
  background: #1f1b27;
  border: 1px solid #6d586b;
  color: var(--amber-light);
  border-radius: 60px;
  padding: 12px 24px;
  backdrop-filter: blur(8px);
}

.study-data-btn:hover {
  background: #302a3a;
  border-color: var(--gold-primary);
  color: var(--gold-primary);
  transform: translateY(-3px);
}

/* ===== GR√ÅFICOS E TABELAS ===== */
#metrics-subject-chart, #metrics-weekly-chart {
  filter: drop-shadow(0 4px 6px #00000060);
}

.metrics-table th {
  background: #231e2a;
  color: var(--amber-light);
  border-bottom: 2px solid var(--gold-primary);
}

.metrics-table td {
  border-bottom: 1px solid #3a3142;
}

/* ===== METAS ===== */
.goal-card {
  position: relative;
  background: #1d1722;
  border: 1px solid #6a5672;
}

.goal-config-button {
  background: #31293b;
  color: #dbbc89;
  border: 1px solid #997e64;
  border-radius: 30px;
  padding: 6px 14px;
  font-size: 0.8rem;
  right: 16px;
  top: 16px;
}

.goal-config-button:hover {
  background: var(--gold-primary);
  color: #161010;
  border-color: var(--gold-primary);
}

.progress-bar-large, .metric-progress {
  background: #2f2638;
  border-radius: 20px;
}

.progress-fill-large, .metric-progress-fill {
  background: linear-gradient(90deg, #e8b35c, #c48b3c);
  border-radius: 20px;
}

/* ===== NOTIFICA√á√ÉO ===== */
.notification {
  background: #2d2535;
  border-left: 8px solid var(--gold-primary);
  color: var(--amber-light);
  border-radius: 60px;
  box-shadow: var(--shadow-lg);
  backdrop-filter: blur(10px);
}

/* ===== NOVA CATEGORIA CORRE√á√ïES (j√° existia no HTML) ===== */
#corrections .task-item {
  background: #1e1925;
}

/* ===== AJUSTES RESPONSIVOS ===== */
@media (max-width: 768px) {
  .container {
    grid-template-columns: 1fr;
  }
  .calendar-grid {
    gap: 6px;
  }
  .calendar-grid .date {
    clip-path: polygon(20% 0%, 80% 0%, 100% 50%, 80% 100%, 20% 100%, 0% 50%);
  }
}

@media (max-width: 480px) {
  .calendar-grid .date {
    font-size: 13px;
  }
  .time-buttons {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Mant√©m todos os hooks originais, nenhuma classe ou ID foi removido */
</style>
</head>
<body>
<!-- Theme toggle oculto (mas preservado) -->
<button id="theme-toggle" class="theme-toggle" style="display:none;"><i class="fas fa-moon"></i></button>

<!-- Bot√£o m√©tricas (estilizado) -->
<button class="metrics-button" onclick="openMetricsModal()">
  <i class="fas fa-chart-pie"></i> Ver M√©tricas
</button>

<div class="notification" id="notification">Parab√©ns! Voc√™ atingiu sua meta mensal! üéâ</div>

<div class="container">
  <!-- Se√ß√£o do Calend√°rio -->
  <div class="animate">
    <div class="calendar" id="calendar">
      <div class="calendar-header">
        <button id="prev"><i class="fas fa-chevron-left"></i></button>
        <h2 id="month-year"></h2>
        <button id="next"><i class="fas fa-chevron-right"></i></button>
      </div>
      <div class="calendar-grid" id="calendar-grid">
        <div class="day">Dom</div><div class="day">Seg</div><div class="day">Ter</div><div class="day">Qua</div><div class="day">Qui</div><div class="day">Sex</div><div class="day">S√°b</div>
      </div>
    </div>

    <!-- Bot√£o cadastrar disciplinas -->
    <div class="subjects-button-container">
      <button class="subjects-button" onclick="openSubjectsModal()">
        <i class="fas fa-book"></i> Cadastrar Disciplinas
      </button>
    </div>

    <!-- Modal Detalhes do Dia -->
    <div class="day-details" id="day-details">
      <div class="day-details-header">
        <button class="close-details" onclick="closeDayDetails()">&times;</button>
        <h2 id="day-title"></h2>
      </div>
      <div class="day-details-content">
        <div class="study-tracker">
          <div class="study-form">
            <select class="subject-select" id="study-subject">
              <option value="" selected disabled>Selecione uma disciplina</option>
            </select>
            <div class="time-controls-container">
              <div class="slider-header">
                <span>Tempo de Estudo</span>
                <span class="slider-value" id="slider-value">0h 00m</span>
              </div>
              <div class="time-buttons">
                <button class="time-btn" data-minutes="15">15 min</button>
                <button class="time-btn" data-minutes="30">30 min</button>
                <button class="time-btn" data-minutes="45">45 min</button>
                <button class="time-btn" data-minutes="60">60 min</button>
              </div>
              <div class="custom-time">
                <input type="number" id="custom-minutes" placeholder="Minutos" min="0" max="60">
                <button class="add-btn" onclick="setCustomTime()"><i class="fas fa-check"></i></button>
              </div>
              <input type="range" min="0" max="60" value="0" class="time-slider" id="study-time">
              <div class="slider-markers">
                <span class="slider-marker">0</span><span class="slider-marker">15</span><span class="slider-marker">30</span><span class="slider-marker">45</span><span class="slider-marker">60</span>
              </div>
            </div>
            <button class="add-btn" onclick="addStudySession()"><i class="fas fa-plus"></i> Adicionar Sess√£o</button>
          </div>
          <div class="time-total">
            <span>Tempo Total:</span>
            <span id="total-time">0h 00m</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="study-progress"></div>
          </div>
          <ul class="session-list" id="session-list"></ul>
        </div>
        <div class="categories">
          <div class="category"><h3><i class="fas fa-question"></i>Quest√µes</h3>
            <div class="task-input-group"><input type="text" class="task-input" id="new-questions" placeholder="Nova quest√£o"><button class="add-btn" data-category="questions"><i class="fas fa-plus"></i> Adicionar</button></div>
            <ul class="tasks-list" id="questions"></ul>
          </div>
          <div class="category"><h3><i class="fas fa-book-open"></i>Aulas</h3>
            <div class="task-input-group"><input type="text" class="task-input" id="new-lessons" placeholder="Nova aula"><button class="add-btn" data-category="lessons"><i class="fas fa-plus"></i> Adicionar</button></div>
            <ul class="tasks-list" id="lessons"></ul>
          </div>
          <div class="category"><h3><i class="fas fa-layer-group"></i>Flashcards</h3>
            <div class="task-input-group"><input type="text" class="task-input" id="new-flashcards" placeholder="Novo flashcard"><button class="add-btn" data-category="flashcards"><i class="fas fa-plus"></i> Adicionar</button></div>
            <ul class="tasks-list" id="flashcards"></ul>
          </div>
          <div class="category"><h3><i class="fas fa-check-double"></i>Corre√ß√µes de Quest√µes</h3>
            <div class="task-input-group"><input type="text" class="task-input" id="new-corrections" placeholder="Nova corre√ß√£o"><button class="add-btn" data-category="corrections"><i class="fas fa-plus"></i> Adicionar</button></div>
            <ul class="tasks-list" id="corrections"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DASHBOARD LATERAL -->
  <div class="dashboard-sidebar">
    <div class="dashboard-header"><h3>Dashboard de Estudos</h3><p>Resumo do seu progresso</p></div>
    <div class="dashboard-metrics">
      <div class="metric-card"><div class="days-container"><div class="day-item"><div class="metric-icon primary"><i class="fas fa-calendar-day"></i></div><div class="metric-value" id="dashboard-days-studied">0</div><div class="metric-label">Dias Estudados</div></div><div class="day-item"><div class="metric-icon danger"><i class="fas fa-calendar-alt"></i></div><div class="metric-value" id="dashboard-days-remaining">-</div><div class="metric-label">Dias Restantes</div></div></div></div>
      <div class="metric-card"><div class="metric-icon secondary"><i class="fas fa-bullseye"></i></div><div class="metric-value" id="dashboard-weekly-goal">0h 00m</div><div class="metric-label">Meta Semanal</div><div class="metric-progress"><div class="metric-progress-fill" id="dashboard-weekly-progress"></div></div></div>
      <div class="metric-card"><div class="metric-icon secondary"><i class="fas fa-bullseye"></i></div><div class="metric-value" id="dashboard-monthly-goal">0h 00m</div><div class="metric-label">Meta Mensal</div><div class="metric-progress"><div class="metric-progress-fill" id="dashboard-monthly-progress"></div></div></div>
      <div class="metric-card"><div class="metric-icon warning"><i class="fas fa-chart-line"></i></div><div class="metric-value" id="dashboard-daily-average">0h 00m</div><div class="metric-label">M√©dia Di√°ria</div></div>
    </div>
  </div>
</div>

<!-- Modal de Disciplinas -->
<div class="modal" id="subjects-modal"><div class="modal-content"><div class="modal-header"><h2>Minhas Disciplinas</h2><button class="close-modal" onclick="closeSubjectsModal()">&times;</button></div><div class="subject-list-container" id="subject-list-container"></div><div class="subject-form"><input type="text" class="subject-input" id="new-subject" placeholder="Nova disciplina"><button class="add-btn" onclick="addNewSubject()"><i class="fas fa-plus"></i> Adicionar</button></div></div></div>

<!-- Modal de Metas -->
<div class="modal" id="goal-modal"><div class="modal-content goal-modal"><div class="modal-header"><h2>Configurar Metas</h2><button class="close-modal" onclick="closeGoalModal()">&times;</button></div><div class="modal-body"><div class="goal-setting"><label for="weekly-goal">Meta Semanal (horas):</label><input type="number" id="weekly-goal" min="0" step="0.5" class="study-input"></div><div class="goal-setting"><label for="monthly-goal">Meta Mensal (horas):</label><input type="number" id="monthly-goal" min="0" step="0.5" class="study-input"></div><button class="add-btn" onclick="saveGoals()" style="margin-top: 20px; width: 100%;"><i class="fas fa-save"></i> Salvar Metas</button></div></div></div>

<!-- Modal Data da Prova -->
<div class="modal" id="exam-modal"><div class="modal-content exam-modal"><div class="modal-header"><h2>Configurar Data da Prova</h2><button class="close-modal" onclick="closeExamModal()">&times;</button></div><div class="modal-body"><div class="exam-form"><div class="exam-form-group"><label class="exam-form-label" for="exam-name">Nome da Prova:</label><input type="text" id="exam-name" class="exam-form-input"></div><div class="exam-form-group"><label class="exam-form-label" for="exam-date">Data da Prova:</label><input type="date" id="exam-date" class="exam-form-input"></div><div class="exam-form-group"><label class="exam-form-label" for="exam-notes">Observa√ß√µes (opcional):</label><textarea id="exam-notes" class="exam-form-textarea"></textarea></div><div class="exam-form-actions"><button class="exam-form-btn secondary" onclick="closeExamModal()"><i class="fas fa-times"></i> Cancelar</button><button class="exam-form-btn primary" onclick="saveExamDate()"><i class="fas fa-save"></i> Salvar Prova</button></div></div></div></div></div>

<!-- Modal de M√©tricas (completo) -->
<div class="modal" id="metrics-modal"><div class="modal-content metrics-modal"><div class="modal-header"><h2>M√©tricas de Estudo</h2><button class="close-modal" onclick="closeMetricsModal()">&times;</button></div><div class="metrics-content"><div class="metrics-header"><h2>Resumo do Seu Progresso</h2><p>Veja suas estat√≠sticas de estudo de forma organizada</p></div><div class="metrics-summary"><div class="summary-card"><i class="fas fa-clock"></i><div class="value" id="metrics-total-time">0h 00m</div><div class="label">Tempo Total</div></div><div class="summary-card"><i class="fas fa-chart-line"></i><div class="value" id="metrics-daily-average">0h 00m</div><div class="label">M√©dia Di√°ria</div></div><div class="summary-card"><i class="fas fa-calendar-day"></i><div class="value" id="metrics-days-studied">0</div><div class="label">Dias Estudados</div></div><div class="summary-card"><i class="fas fa-list-check"></i><div class="value" id="metrics-total-sessions">0</div><div class="label">Sess√µes Totais</div></div></div><div class="metrics-charts"><div class="chart-container-large"><h3><i class="fas fa-chart-pie"></i> Distribui√ß√£o por Disciplina</h3><div class="chart-canvas-container"><canvas id="metrics-subject-chart"></canvas></div></div><div class="chart-container-large"><h3><i class="fas fa-chart-bar"></i> Progresso Semanal</h3><div class="chart-canvas-container"><canvas id="metrics-weekly-chart"></canvas></div></div></div><div class="metrics-table-container"><h3><i class="fas fa-table"></i> Detalhes por Disciplina</h3><div class="table-responsive"><table class="metrics-table" id="metrics-subject-table"><thead><tr><th data-sort="subject">Disciplina</th><th data-sort="time">Tempo Total</th><th data-sort="percentage">% do Total</th><th data-sort="sessions">Sess√µes</th></tr></thead><tbody id="metrics-subject-table-body"></tbody></table></div></div><div class="goals-section"><div class="goal-card"><button class="goal-config-button" onclick="openGoalSettings()"><i class="fas fa-cog"></i> Configurar</button><h3><i class="fas fa-bullseye"></i> Meta Semanal</h3><div class="goal-progress-large"><div class="progress-bar-large"><div class="progress-fill-large" id="metrics-weekly-progress-bar"></div></div><div class="goal-stats"><span class="current" id="metrics-weekly-current">0h 00m</span><span class="total" id="metrics-weekly-total">/ 0h 00m</span></div></div></div><div class="goal-card"><button class="goal-config-button" onclick="openGoalSettings()"><i class="fas fa-cog"></i> Configurar</button><h3><i class="fas fa-bullseye"></i> Meta Mensal</h3><div class="goal-progress-large"><div class="progress-bar-large"><div class="progress-fill-large" id="metrics-monthly-progress-bar"></div></div><div class="goal-stats"><span class="current" id="metrics-monthly-current">0h 00m</span><span class="total" id="metrics-monthly-total">/ 0h 00m</span></div></div></div></div><div class="metrics-table-container"><h3><i class="fas fa-calendar-alt"></i> Configurar Data da Prova</h3><div class="exam-form"><div class="exam-form-group"><label class="exam-form-label" for="metrics-exam-name">Nome da Prova:</label><input type="text" id="metrics-exam-name" class="exam-form-input"></div><div class="exam-form-group"><label class="exam-form-label" for="metrics-exam-date">Data da Prova:</label><input type="date" id="metrics-exam-date" class="exam-form-input"></div><div class="exam-form-group"><label class="exam-form-label" for="metrics-exam-notes">Observa√ß√µes (opcional):</label><textarea id="metrics-exam-notes" class="exam-form-textarea"></textarea></div><div class="exam-form-actions"><button class="exam-form-btn secondary" onclick="clearExamDate()"><i class="fas fa-times"></i> Limpar</button><button class="exam-form-btn primary" onclick="saveExamDateFromMetrics()"><i class="fas fa-save"></i> Salvar Prova</button></div></div></div></div></div></div>

<!-- Bot√µes export/import -->
<div class="study-data-buttons">
  <button class="study-data-btn" onclick="exportStudyData()"><i class="fas fa-file-export"></i> Exportar</button>
  <button class="study-data-btn import" onclick="importStudyData()"><i class="fas fa-file-import"></i> Importar</button>
</div>

<script>
// ==============================================
// CORRE√á√ÉO DOS BOT√ïES DE CONFIGURA√á√ÉO DE METAS
// ==============================================

// Configura√ß√µes Iniciais
const today = new Date();
let currentMonth = parseInt(localStorage.getItem('currentMonth')) || today.getMonth();
let currentYear = parseInt(localStorage.getItem('currentYear')) || today.getFullYear();
let selectedDate = null;
let subjectChart = null;
let metricsSubjectChart = null;
let metricsWeeklyChart = null;
// Metas do usu√°rio
let weeklyGoal = parseInt(localStorage.getItem('weeklyGoal')) || 20 * 60; // 20 horas em minutos
let monthlyGoal = parseInt(localStorage.getItem('monthlyGoal')) || 80 * 60; // 80 horas em minutos

// Elementos DOM
const elements = {
    monthYear: document.getElementById('month-year'),
    calendarGrid: document.getElementById('calendar-grid'),
    prevButton: document.getElementById('prev'),
    nextButton: document.getElementById('next'),
    dayDetails: document.getElementById('day-details'),
    calendar: document.getElementById('calendar'),
    dayTitle: document.getElementById('day-title'),
    studySubject: document.getElementById('study-subject'),
    sessionList: document.getElementById('session-list'),
    totalTime: document.getElementById('total-time'),
    studyProgress: document.getElementById('study-progress'),
    studyTime: document.getElementById('study-time'),
    sliderValue: document.getElementById('slider-value'),
    subjectsModal: document.getElementById('subjects-modal'),
    subjectListContainer: document.getElementById('subject-list-container'),
    newSubject: document.getElementById('new-subject'),
    themeToggle: document.getElementById('theme-toggle'),
    goalModal: document.getElementById('goal-modal'),
    notification: document.getElementById('notification'),
    // Novos elementos para o modal de m√©tricas
    metricsModal: document.getElementById('metrics-modal'),
    metricsTotalTime: document.getElementById('metrics-total-time'),
    metricsDailyAverage: document.getElementById('metrics-daily-average'),
    metricsDaysStudied: document.getElementById('metrics-days-studied'),
    metricsTotalSessions: document.getElementById('metrics-total-sessions'),
    metricsSubjectChart: document.getElementById('metrics-subject-chart'),
    metricsWeeklyChart: document.getElementById('metrics-weekly-chart'),
    metricsSubjectTableBody: document.getElementById('metrics-subject-table-body'),
    metricsWeeklyProgressBar: document.getElementById('metrics-weekly-progress-bar'),
    metricsMonthlyProgressBar: document.getElementById('metrics-monthly-progress-bar'),
    metricsWeeklyCurrent: document.getElementById('metrics-weekly-current'),
    metricsWeeklyTotal: document.getElementById('metrics-weekly-total'),
    metricsMonthlyCurrent: document.getElementById('metrics-monthly-current'),
    metricsMonthlyTotal: document.getElementById('metrics-monthly-total'),
    // Elementos do dashboard lateral - NOVA VERS√ÉO
    dashboardDaysStudied: document.getElementById('dashboard-days-studied'),
    dashboardDaysRemaining: document.getElementById('dashboard-days-remaining'),
    dashboardDailyAverage: document.getElementById('dashboard-daily-average'),
    dashboardWeeklyGoal: document.getElementById('dashboard-weekly-goal'),
    dashboardMonthlyGoal: document.getElementById('dashboard-monthly-goal'),
    dashboardWeeklyProgress: document.getElementById('dashboard-weekly-progress'),
    dashboardMonthlyProgress: document.getElementById('dashboard-monthly-progress'),
    // Novos elementos para a funcionalidade de provas
    examModal: document.getElementById('exam-modal')
};

const months = [
    'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
];

// ==============================================
// NOVAS FUN√á√ïES PARA O DASHBOARD LATERAL - VERS√ÉO MINIMALISTA
// ==============================================
function updateDashboard() {
    const allSessions = getAllSessions();
    const stats = calculateStats(allSessions);
    updateMetricsModal(stats);
    updateSidebarDashboard(stats);
}

function updateSidebarDashboard(stats) {
    if (!stats) {
        const allSessions = getAllSessions();
        stats = calculateStats(allSessions);
    }
    
    // Dias estudados
    elements.dashboardDaysStudied.textContent = stats.daysStudied;
    
    // M√©dia di√°ria
    const avgHours = Math.floor(stats.dailyAverage / 60);
    const avgMinutes = Math.round(stats.dailyAverage % 60);
    elements.dashboardDailyAverage.textContent = `${avgHours}h ${avgMinutes.toString().padStart(2, '0')}m`;
    
    // Meta semanal
    const weeklyGoalHours = Math.floor(weeklyGoal / 60);
    const weeklyGoalMinutes = weeklyGoal % 60;
    elements.dashboardWeeklyGoal.textContent = `${weeklyGoalHours}h ${weeklyGoalMinutes.toString().padStart(2, '0')}m`;
    
    // Progresso da meta semanal
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay()); // Domingo
    startOfWeek.setHours(0, 0, 0, 0);
    const endOfWeek = new Date(today);
    endOfWeek.setDate(today.getDate() + (6 - today.getDay())); // S√°bado
    endOfWeek.setHours(23, 59, 59, 999);
    const weeklyMinutes = calculateWeeklyTime(startOfWeek, endOfWeek);
    const weeklyProgress = weeklyGoal > 0 ? Math.min((weeklyMinutes / weeklyGoal) * 100, 100) : 0;
    elements.dashboardWeeklyProgress.style.width = `${weeklyProgress}%`;
    
    // Meta mensal
    const monthlyGoalHours = Math.floor(monthlyGoal / 60);
    const monthlyGoalMinutes = monthlyGoal % 60;
    elements.dashboardMonthlyGoal.textContent = `${monthlyGoalHours}h ${monthlyGoalMinutes.toString().padStart(2, '0')}m`;
    
    // Progresso da meta mensal
    const monthlyMinutes = calculateMonthlyTime(today.getMonth(), today.getFullYear());
    const monthlyProgress = monthlyGoal > 0 ? Math.min((monthlyMinutes / monthlyGoal) * 100, 100) : 0;
    elements.dashboardMonthlyProgress.style.width = `${monthlyProgress}%`;
    
    // Atualizar dias restantes para a prova
    updateExamCountdown();
}

// ==============================================
// NOVAS FUN√á√ïES PARA O SISTEMA DE PROVAS - VERS√ÉO MINIMALISTA
// ==============================================
function openExamModal() {
    // Limpa os campos do formul√°rio
    document.getElementById('exam-name').value = '';
    document.getElementById('exam-date').value = '';
    document.getElementById('exam-notes').value = '';
    
    elements.examModal.classList.add('active');
}

function closeExamModal() {
    elements.examModal.classList.remove('active');
}

function saveExamDate() {
    const examName = document.getElementById('exam-name').value.trim();
    const examDate = document.getElementById('exam-date').value;
    const examNotes = document.getElementById('exam-notes').value.trim();
    
    if (!examName || !examDate) {
        alert('Por favor, preencha pelo menos o nome e a data da prova.');
        return;
    }
    
    // Salva os dados da prova no localStorage
    const examData = {
        name: examName,
        date: examDate,
        notes: examNotes,
        createdAt: new Date().toISOString()
    };
    
    localStorage.setItem('examData', JSON.stringify(examData));
    closeExamModal();
    updateExamCountdown();
    showNotification('Prova salva com sucesso!');
}

function updateExamCountdown() {
    const examData = JSON.parse(localStorage.getItem('examData'));
    const daysRemainingElement = elements.dashboardDaysRemaining;
    
    if (!examData) {
        daysRemainingElement.textContent = '-';
        return;
    }
    
    // Calcula a diferen√ßa em dias
    const examDate = new Date(examData.date);
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Define para meia-noite para c√°lculo preciso
    
    const diffTime = examDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays < 0) {
        daysRemainingElement.textContent = '0';
    } else {
        daysRemainingElement.textContent = diffDays;
    }
}

function deleteExamDate() {
    if (confirm('Tem certeza que deseja excluir os dados da prova?')) {
        localStorage.removeItem('examData');
        updateExamCountdown();
        showNotification('Dados da prova removidos com sucesso!');
    }
}

// ==============================================
// FUN√á√ïES PARA CONFIGURAR PROVA NO MODAL DE M√âTRICAS
// ==============================================
function saveExamDateFromMetrics() {
    const examName = document.getElementById('metrics-exam-name').value.trim();
    const examDate = document.getElementById('metrics-exam-date').value;
    const examNotes = document.getElementById('metrics-exam-notes').value.trim();
    
    if (!examName || !examDate) {
        alert('Por favor, preencha pelo menos o nome e a data da prova.');
        return;
    }
    
    // Salva os dados da prova no localStorage
    const examData = {
        name: examName,
        date: examDate,
        notes: examNotes,
        createdAt: new Date().toISOString()
    };
    
    localStorage.setItem('examData', JSON.stringify(examData));
    updateExamCountdown();
    showNotification('Prova salva com sucesso!');
    
    // Atualiza o dashboard
    updateDashboard();
}

function clearExamDate() {
    if (confirm('Tem certeza que deseja limpar os dados da prova?')) {
        localStorage.removeItem('examData');
        document.getElementById('metrics-exam-name').value = '';
        document.getElementById('metrics-exam-date').value = '';
        document.getElementById('metrics-exam-notes').value = '';
        updateExamCountdown();
        showNotification('Dados da prova removidos com sucesso!');
        
        // Atualiza o dashboard
        updateDashboard();
    }
}

// ==============================================
// NOVAS FUN√á√ïES PARA O MODAL DE M√âTRICAS
// ==============================================
function openMetricsModal() {
    updateMetricsModal();
    elements.metricsModal.classList.add('active');
}

function closeMetricsModal() {
    elements.metricsModal.classList.remove('active');
}

// ==============================================
// CORRE√á√ÉO: FUN√á√ÉO PARA ABRIR CONFIGURA√á√ÉO DE METAS
// ==============================================
function openGoalSettings() {
    closeMetricsModal();
    openGoalModal();
}

function openGoalModal() {
    // Preencher os campos com as metas atuais (convertendo para horas)
    document.getElementById('weekly-goal').value = (weeklyGoal / 60).toFixed(1);
    document.getElementById('monthly-goal').value = (monthlyGoal / 60).toFixed(1);
    elements.goalModal.classList.add('active');
}

function closeGoalModal() {
    elements.goalModal.classList.remove('active');
}

function saveGoals() {
    // Obter os valores dos inputs e converter para minutos
    const weeklyHours = parseFloat(document.getElementById('weekly-goal').value);
    const monthlyHours = parseFloat(document.getElementById('monthly-goal').value);
    
    if (!isNaN(weeklyHours)) {
        weeklyGoal = weeklyHours * 60;
        localStorage.setItem('weeklyGoal', weeklyGoal);
    }
    
    if (!isNaN(monthlyHours)) {
        monthlyGoal = monthlyHours * 60;
        localStorage.setItem('monthlyGoal', monthlyGoal);
    }
    
    // Atualizar as barras de progresso
    updateDashboard();
    closeGoalModal();
    
    // Mostrar notifica√ß√£o
    showNotification('Metas atualizadas com sucesso!');
}

// Resto do c√≥digo permanece igual...

// Fun√ß√µes do Calend√°rio
function renderCalendar(month, year) {
    elements.calendarGrid.innerHTML = '<div class="day">Dom</div><div class="day">Seg</div><div class="day">Ter</div><div class="day">Qua</div><div class="day">Qui</div><div class="day">Sex</div><div class="day">S√°b</div>';
    elements.monthYear.textContent = `${months[month]} ${year}`;
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    for (let i = 0; i < firstDay; i++) {
        elements.calendarGrid.appendChild(document.createElement('div'));
    }
    
    for (let date = 1; date <= daysInMonth; date++) {
        const dateCell = document.createElement('div');
        dateCell.className = 'date';
        dateCell.textContent = date;
        dateCell.setAttribute('data-date', `${date}-${month+1}-${year}`);
        
        if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
            dateCell.classList.add('today');
        }
        
        const tasks = loadTasks(`${date}-${month + 1}-${year}`);
        if (Object.values(tasks).some(arr => arr.length > 0)) {
            const dot = document.createElement('div');
            dot.className = 'task-dot';
            dateCell.appendChild(dot);
        }
        
        dateCell.onclick = () => openDayDetails(date, month, year);
        elements.calendarGrid.appendChild(dateCell);
    }
    
    // Marcar dias completos
    markCompletedDays();
}

// CORRE√á√ÉO: Fun√ß√£o loadTasks atualizada para garantir que a categoria "corrections" exista
const getStorageKey = (date) => `tasks-${date}`;

const loadTasks = (date) => {
    const key = getStorageKey(date);
    const savedData = localStorage.getItem(key);
    let tasks;
    
    if (savedData) {
        tasks = JSON.parse(savedData);
        // Garante que a categoria 'corrections' exista
        if (!tasks.hasOwnProperty('corrections')) {
            tasks.corrections = [];
        }
    } else {
        // Inicializa com todas as categorias, incluindo 'corrections'
        tasks = {
            questions: [],
            lessons: [],
            flashcards: [],
            corrections: []
        };
    }
    return tasks;
};

const saveTasks = (date, tasks) => localStorage.setItem(getStorageKey(date), JSON.stringify(tasks));

// Fun√ß√µes de Tarefas
function openDayDetails(date, month, year) {
    selectedDate = `${date}-${month + 1}-${year}`;
    elements.dayTitle.textContent = `${date} de ${months[month]} ${year}`;
    const tasks = loadTasks(selectedDate);
    
    for (const category in tasks) {
        const list = document.getElementById(category);
        list.innerHTML = '';
        tasks[category].forEach(task => createTaskItem(category, task.text, task.completed));
    }
    
    updateStudyDisplay();
    elements.calendar.classList.remove('active');
    elements.dayDetails.classList.add('active');
}

function createTaskItem(category, text, completed = false) {
    const li = document.createElement('li');
    li.className = 'task-item';
    
    const textSpan = document.createElement('span');
    textSpan.className = 'task-text';
    textSpan.contentEditable = true;
    textSpan.textContent = text;
    textSpan.onblur = () => updateTaskText(category, text, textSpan.textContent);
    
    if (completed) {
        textSpan.style.textDecoration = 'line-through';
        textSpan.style.opacity = '0.7';
    }
    
    const completeBtn = document.createElement('button');
    completeBtn.className = 'task-btn complete';
    completeBtn.innerHTML = '<i class="fas fa-check"></i>';
    completeBtn.onclick = () => toggleTaskComplete(textSpan, category, text);
    
    const removeBtn = document.createElement('button');
    removeBtn.className = 'task-btn remove';
    removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
    removeBtn.onclick = () => {
        li.remove();
        updateTasks(category, text, false, true);
    };
    
    li.append(textSpan, completeBtn, removeBtn);
    document.getElementById(category).appendChild(li);
}

function toggleTaskComplete(element, category, oldText) {
    const completed = element.style.textDecoration === 'line-through';
    element.style.textDecoration = completed ? 'none' : 'line-through';
    element.style.opacity = completed ? '1' : '0.7';
    updateTasks(category, oldText, !completed);
}

function updateTasks(category, oldText, completed = false, remove = false) {
    const tasks = loadTasks(selectedDate);
    
    if (remove) {
        tasks[category] = tasks[category].filter(t => t.text !== oldText);
    } else {
        const existingIndex = tasks[category].findIndex(t => t.text === oldText);
        if (existingIndex > -1) {
            tasks[category][existingIndex] = { text: tasks[category][existingIndex].text, completed };
        } else {
            tasks[category].push({ text: oldText, completed });
        }
    }
    
    saveTasks(selectedDate, tasks);
}

function updateTaskText(category, oldText, newText) {
    const tasks = loadTasks(selectedDate);
    const taskIndex = tasks[category].findIndex(t => t.text === oldText);
    
    if (taskIndex > -1) {
        tasks[category][taskIndex].text = newText;
        saveTasks(selectedDate, tasks);
    }
}

// Fun√ß√µes de Estudo
function addStudySession() {
    const subject = elements.studySubject.value;
    const minutes = parseInt(elements.studyTime.value);
    
    if (!subject || minutes === 0) {
        alert('Selecione uma disciplina e escolha o tempo!');
        return;
    }
    
    // Adiciona a mat√©ria √† lista personalizada
    addCustomSubject(subject);
    
    const session = {
        subject,
        minutes: minutes,
        date: selectedDate,
        timestamp: new Date().toISOString()
    };
    
    const sessions = JSON.parse(localStorage.getItem(`sessions-${selectedDate}`) || '[]');
    sessions.push(session);
    localStorage.setItem(`sessions-${selectedDate}`, JSON.stringify(sessions));
    
    updateStudyDisplay();
    clearStudyInputs();
    updateDashboard();
    
    // Marcar dia como completo
    markCompletedDays();
}

function updateStudyDisplay() {
    const sessions = JSON.parse(localStorage.getItem(`sessions-${selectedDate}`) || '[]');
    elements.sessionList.innerHTML = '';
    let totalMinutes = 0;
    
    sessions.forEach(session => {
        totalMinutes += session.minutes;
        const li = document.createElement('li');
        li.className = 'session-item';
        li.innerHTML = `
            <div class="session-info">
                <span class="subject-name">${session.subject}</span>
                <span class="session-time">${Math.floor(session.minutes/60)}h ${(session.minutes%60).toString().padStart(2, '0')}m</span>
                <span class="session-time">${new Date(session.timestamp).toLocaleTimeString()}</span>
            </div>
            <div class="session-actions">
                <button class="task-btn remove" onclick="deleteStudySession('${session.timestamp}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        elements.sessionList.appendChild(li);
    });
    
    elements.totalTime.textContent = `${Math.floor(totalMinutes/60)}h ${(totalMinutes%60).toString().padStart(2, '0')}m`;
    elements.studyProgress.style.width = `${Math.min((totalMinutes / (4 * 60)) * 100, 100)}%`; // 4 horas como meta di√°ria padr√£o
}

function deleteStudySession(timestamp) {
    const sessions = JSON.parse(localStorage.getItem(`sessions-${selectedDate}`) || '[]')
        .filter(session => session.timestamp !== timestamp);
    localStorage.setItem(`sessions-${selectedDate}`, JSON.stringify(sessions));
    
    updateStudyDisplay();
    updateDashboard();
    
    // Marcar dia como completo
    markCompletedDays();
}

// Fun√ß√µes do Dashboard
function getAllSessions() {
    const sessions = [];
    
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('sessions-')) {
            sessions.push(...JSON.parse(localStorage.getItem(key)));
        }
    }
    
    return sessions;
}

// ==============================================
// ATUALIZA√á√ÉO: Fun√ß√£o calculateStats com contagem correta de dias estudados
// ==============================================
function calculateStats(sessions) {
    const stats = {
        total: 0,
        bySubject: {},
        days: {},
        dailyAverage: 0,
        totalSessions: 0,
        daysStudied: 0,
        weeklyData: {}
    };
    
    sessions.forEach(session => {
        stats.total += session.minutes;
        stats.totalSessions++;
        
        if (!stats.bySubject[session.subject]) {
            stats.bySubject[session.subject] = { minutes: 0, count: 0 };
        }
        
        stats.bySubject[session.subject].minutes += session.minutes;
        stats.bySubject[session.subject].count++;
        
        const date = session.date;
        if (!stats.days[date]) {
            stats.daysStudied++;
        }
        
        stats.days[date] = (stats.days[date] || 0) + session.minutes;
        
        // Calcular dados semanais
        const sessionDate = new Date(session.timestamp);
        const weekStart = new Date(sessionDate);
        weekStart.setDate(sessionDate.getDate() - sessionDate.getDay()); // Domingo
        const weekKey = weekStart.toISOString().split('T')[0];
        
        if (!stats.weeklyData[weekKey]) {
            stats.weeklyData[weekKey] = 0;
        }
        stats.weeklyData[weekKey] += session.minutes;
    });
    
    const totalDays = Object.keys(stats.days).length;
    stats.dailyAverage = totalDays > 0 ? stats.total / totalDays : 0;
    
    return stats;
}

function updateMetricsModal(stats = null) {
    if (!stats) {
        const allSessions = getAllSessions();
        stats = calculateStats(allSessions);
    }
    
    // Atualizar cards de resumo
    updateMetricsSummaryCards(stats);
    
    // Atualizar gr√°ficos
    updateMetricsCharts(stats);
    
    // Atualizar tabela de disciplinas
    updateMetricsSubjectTable(stats);
    
    // Atualizar progresso de metas
    updateMetricsGoals(stats);
    
    // Preenche os dados da prova, se existirem
    const examData = JSON.parse(localStorage.getItem('examData'));
    if (examData) {
        document.getElementById('metrics-exam-name').value = examData.name;
        document.getElementById('metrics-exam-date').value = examData.date;
        document.getElementById('metrics-exam-notes').value = examData.notes || '';
    } else {
        document.getElementById('metrics-exam-name').value = '';
        document.getElementById('metrics-exam-date').value = '';
        document.getElementById('metrics-exam-notes').value = '';
    }
}

function updateMetricsSummaryCards(stats) {
    // Tempo total
    const totalHours = Math.floor(stats.total / 60);
    const totalMinutes = stats.total % 60;
    elements.metricsTotalTime.textContent = `${totalHours}h ${totalMinutes.toString().padStart(2, '0')}m`;
    
    // M√©dia di√°ria
    const avgHours = Math.floor(stats.dailyAverage / 60);
    const avgMinutes = Math.round(stats.dailyAverage % 60);
    elements.metricsDailyAverage.textContent = `${avgHours}h ${avgMinutes.toString().padStart(2, '0')}m`;
    
    // Dias estudados
    elements.metricsDaysStudied.textContent = stats.daysStudied;
    
    // Sess√µes totais
    elements.metricsTotalSessions.textContent = stats.totalSessions;
}

function updateMetricsCharts(stats) {
    updateMetricsSubjectChart(stats);
    updateMetricsWeeklyChart(stats);
}

function updateMetricsSubjectChart(stats) {
    const ctx = elements.metricsSubjectChart.getContext('2d');
    const subjects = Object.keys(stats.bySubject);
    const values = Object.values(stats.bySubject).map(d => d.minutes);
    
    // Gerar cores pastel para todas as disciplinas
    const backgroundColors = generatePastelColors(subjects.length);
    
    if (metricsSubjectChart) metricsSubjectChart.destroy();
    
    metricsSubjectChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: subjects,
            datasets: [{
                data: values,
                backgroundColor: backgroundColors,
                borderColor: '#FFFFFF',
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        boxWidth: 10
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const minutes = context.raw;
                            const hours = Math.floor(minutes / 60);
                            const mins = minutes % 60;
                            const percentage = ((minutes / stats.total) * 100).toFixed(1);
                            return `${context.label}: ${hours}h ${mins}m (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}

function updateMetricsWeeklyChart(stats) {
    const ctx = elements.metricsWeeklyChart.getContext('2d');
    
    // Preparar dados das √∫ltimas 8 semanas
    const weeklyData = getWeeklyData();
    
    if (metricsWeeklyChart) metricsWeeklyChart.destroy();
    
    metricsWeeklyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: weeklyData.labels,
            datasets: [{
                label: 'Horas Estudadas',
                data: weeklyData.data,
                backgroundColor: 'rgba(124, 175, 146, 0.7)',
                borderColor: 'rgba(124, 175, 146, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Horas'
                    },
                    ticks: {
                        callback: function(value) {
                            return value + 'h';
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Semanas'
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const hours = Math.floor(context.raw / 60);
                            const minutes = context.raw % 60;
                            return `${hours}h ${minutes}m`;
                        }
                    }
                }
            }
        }
    });
}

function getWeeklyData() {
    const result = {
        labels: [],
        data: []
    };
    
    // Obter as √∫ltimas 8 semanas
    const today = new Date();
    for (let i = 7; i >= 0; i--) {
        const weekStart = new Date(today);
        weekStart.setDate(today.getDate() - today.getDay() - (i * 7));
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        
        const weekKey = weekStart.toISOString().split('T')[0];
        const weekMinutes = calculateWeeklyTime(weekStart, weekEnd);
        
        // Formatar label da semana
        const label = `${weekStart.getDate()}/${weekStart.getMonth()+1} - ${weekEnd.getDate()}/${weekEnd.getMonth()+1}`;
        
        result.labels.push(label);
        result.data.push(weekMinutes);
    }
    
    return result;
}

function updateMetricsSubjectTable(stats) {
    const tableBody = elements.metricsSubjectTableBody;
    tableBody.innerHTML = '';
    
    const subjects = Object.entries(stats.bySubject);
    
    // Ordenar por tempo (decrescente)
    subjects.sort((a, b) => b[1].minutes - a[1].minutes);
    
    subjects.forEach(([subject, data]) => {
        const minutes = data.minutes;
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        const percentage = ((minutes / stats.total) * 100).toFixed(1);
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${subject}</td>
            <td>${hours}h ${mins.toString().padStart(2, '0')}m</td>
            <td>${percentage}%</td>
            <td>${data.count}</td>
        `;
        tableBody.appendChild(row);
    });
    
    // Adicionar evento de ordena√ß√£o √†s colunas
    document.querySelectorAll('#metrics-subject-table th').forEach(th => {
        th.addEventListener('click', () => {
            const column = th.dataset.sort;
            sortMetricsTable(column);
        });
    });
}

function sortMetricsTable(column) {
    const table = document.getElementById('metrics-subject-table');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    rows.sort((a, b) => {
        const aValue = getCellValue(a, column);
        const bValue = getCellValue(b, column);
        
        if (column === 'subject') {
            return aValue.localeCompare(bValue);
        } else {
            return parseFloat(bValue) - parseFloat(aValue);
        }
    });
    
    // Limpar e reordenar a tabela
    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
}

function getCellValue(row, column) {
    const cellIndex = {
        'subject': 0,
        'time': 1,
        'percentage': 2,
        'sessions': 3
    }[column];
    
    const cell = row.cells[cellIndex];
    let value = cell.textContent;
    
    if (column === 'time') {
        // Converter "Xh Ym" para minutos
        const match = value.match(/(\d+)h\s*(\d+)m/);
        if (match) {
            const hours = parseInt(match[1]);
            const minutes = parseInt(match[2]);
            value = hours * 60 + minutes;
        }
    } else if (column === 'percentage') {
        value = parseFloat(value);
    } else if (column === 'sessions') {
        value = parseInt(value);
    }
    
    return value;
}

function updateMetricsGoals(stats) {
    // Calcular tempo estudado no m√™s atual
    const monthlyMinutes = calculateMonthlyTime(today.getMonth(), today.getFullYear());
    
    // Calcular tempo estudado na semana atual
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay()); // Domingo
    startOfWeek.setHours(0, 0, 0, 0);
    const endOfWeek = new Date(today);
    endOfWeek.setDate(today.getDate() + (6 - today.getDay())); // S√°bado
    endOfWeek.setHours(23, 59, 59, 999);
    const weeklyMinutes = calculateWeeklyTime(startOfWeek, endOfWeek);
    
    // Atualizar progresso semanal
    const weeklyProgress = weeklyGoal > 0 ? Math.min((weeklyMinutes / weeklyGoal) * 100, 100) : 0;
    elements.metricsWeeklyProgressBar.style.width = `${weeklyProgress}%`;
    
    const weeklyHours = Math.floor(weeklyMinutes / 60);
    const weeklyMins = weeklyMinutes % 60;
    const weeklyGoalHours = Math.floor(weeklyGoal / 60);
    const weeklyGoalMins = weeklyGoal % 60;
    
    elements.metricsWeeklyCurrent.textContent = `${weeklyHours}h ${weeklyMins.toString().padStart(2, '0')}m`;
    elements.metricsWeeklyTotal.textContent = `/ ${weeklyGoalHours}h ${weeklyGoalMins.toString().padStart(2, '0')}m`;
    
    // Atualizar progresso mensal
    const monthlyProgress = monthlyGoal > 0 ? Math.min((monthlyMinutes / monthlyGoal) * 100, 100) : 0;
    elements.metricsMonthlyProgressBar.style.width = `${monthlyProgress}%`;
    
    const monthlyHours = Math.floor(monthlyMinutes / 60);
    const monthlyMins = monthlyMinutes % 60;
    const monthlyGoalHours = Math.floor(monthlyGoal / 60);
    const monthlyGoalMins = monthlyGoal % 60;
    
    elements.metricsMonthlyCurrent.textContent = `${monthlyHours}h ${monthlyMins.toString().padStart(2, '0')}m`;
    elements.metricsMonthlyTotal.textContent = `/ ${monthlyGoalHours}h ${monthlyGoalMins.toString().padStart(2, '0')}m`;
}

// Fun√ß√£o para gerar cores pastel √∫nicas
function generatePastelColors(count) {
    const colors = [];
    for (let i = 0; i < count; i++) {
        // Gera cores pastel com diferentes matizes
        const hue = (i * 360 / Math.max(count, 1)) % 360;
        colors.push(`hsl(${hue}, 70%, 80%)`);
    }
    return colors;
}

// Fun√ß√µes Auxiliares
function clearStudyInputs() {
    elements.studySubject.value = '';
    elements.studyTime.value = 0;
    elements.sliderValue.textContent = '0h 00m';
    document.querySelectorAll('.time-btn').forEach(btn => {
        btn.classList.remove('active');
    });
}

// Fun√ß√µes de Mat√©rias Personalizadas
function addCustomSubject(subject) {
    if (!subject) return;
    const subjects = JSON.parse(localStorage.getItem('customSubjects')) || [];
    // Evita duplicatas
    if (!subjects.includes(subject)) {
        subjects.push(subject);
        localStorage.setItem('customSubjects', JSON.stringify(subjects));
        updateSubjectsDropdown();
    }
}

// Atualizar o dropdown de disciplinas
function updateSubjectsDropdown() {
    const subjects = JSON.parse(localStorage.getItem('customSubjects')) || [];
    const dropdown = elements.studySubject;
    // Remove todas as op√ß√µes exceto a primeira
    while (dropdown.options.length > 1) {
        dropdown.remove(1);
    }
    // Adiciona as disciplinas cadastradas
    subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        dropdown.appendChild(option);
    });
}

// Configurar bot√µes de tempo
function setupTimeButtons() {
    document.querySelectorAll('.time-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const minutes = parseInt(this.dataset.minutes);
            const currentMinutes = parseInt(elements.studyTime.value) || 0;
            const newMinutes = currentMinutes + minutes;
            // Limitar a 60 minutos
            if (newMinutes > 60) {
                elements.studyTime.value = 60;
            } else {
                elements.studyTime.value = newMinutes;
            }
            // Atualiza o valor exibido
            const hours = Math.floor(elements.studyTime.value / 60);
            const mins = elements.studyTime.value % 60;
            elements.sliderValue.textContent = `${hours}h ${mins.toString().padStart(2, '0')}m`;
            // Dispara o evento do slider para atualizar a interface
            elements.studyTime.dispatchEvent(new Event('input'));
        });
    });
}

// Definir tempo personalizado
function setCustomTime() {
    const minutes = parseInt(document.getElementById('custom-minutes').value);
    if (minutes >= 0 && minutes <= 60) {
        elements.studyTime.value = minutes;
        // Atualiza o valor exibido
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        elements.sliderValue.textContent = `${hours}h ${mins.toString().padStart(2, '0')}m`;
        // Dispara o evento do slider para atualizar a interface
        elements.studyTime.dispatchEvent(new Event('input'));
    } else {
        alert('Insira um valor entre 0 e 60 minutos');
    }
}

// FUN√á√ïES PARA AS METAS DE ESTUDO (CORRIGIDAS)
// Fun√ß√£o para calcular o tempo estudado em um m√™s espec√≠fico (0-11)
function calculateMonthlyTime(month, year) {
    let totalMinutes = 0;
    // O m√™s em JavaScript: 0-11, mas nossa chave usa m√™s de 1-12
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${day}-${month + 1}-${year}`;
        const sessions = JSON.parse(localStorage.getItem(`sessions-${dateKey}`) || '[]');
        sessions.forEach(session => {
            totalMinutes += session.minutes;
        });
    }
    return totalMinutes;
}

// Fun√ß√£o para calcular o tempo estudado em um intervalo de datas (objetos Date)
function calculateWeeklyTime(startDate, endDate) {
    let totalMinutes = 0;
    const current = new Date(startDate);
    const last = new Date(endDate);
    while (current <= last) {
        const day = current.getDate();
        const month = current.getMonth() + 1; // porque no formato dd-mm-yyyy, o m√™s √© 1-12
        const year = current.getFullYear();
        const dateKey = `${day}-${month}-${year}`;
        const sessions = JSON.parse(localStorage.getItem(`sessions-${dateKey}`) || '[]');
        sessions.forEach(session => {
            totalMinutes += session.minutes;
        });
        current.setDate(current.getDate() + 1); // Avan√ßa um dia
    }
    return totalMinutes;
}

// Exibir notifica√ß√£o de meta atingida
function showGoalAchieved(type) {
    elements.notification.textContent = `Parab√©ns! Voc√™ atingiu sua meta ${type}! üéâ`;
    elements.notification.classList.add('show');
    setTimeout(() => {
        elements.notification.classList.remove('show');
    }, 3000);
}

// Altern√¢ncia de tema
function toggleTheme() {
    document.body.classList.toggle('light-theme');
    const isLight = document.body.classList.contains('light-theme');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    if (isLight) {
        elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
        elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
    // Atualiza o modal de m√©tricas quando o tema muda
    updateDashboard();
}

// Verificar tema salvo
function checkSavedTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
}

function showNotification(message) {
    elements.notification.textContent = message;
    elements.notification.classList.add('show');
    setTimeout(() => {
        elements.notification.classList.remove('show');
    }, 3000);
}

// Event Listeners
elements.prevButton.addEventListener('click', () => {
    currentMonth--;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    }
    localStorage.setItem('currentMonth', currentMonth);
    localStorage.setItem('currentYear', currentYear);
    renderCalendar(currentMonth, currentYear);
    updateDashboard(); // Atualizar m√©tricas ao mudar m√™s
});

elements.nextButton.addEventListener('click', () => {
    currentMonth++;
    if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    localStorage.setItem('currentMonth', currentMonth);
    localStorage.setItem('currentYear', currentYear);
    renderCalendar(currentMonth, currentYear);
    updateDashboard(); // Atualizar m√©tricas ao mudar m√™s
});

document.querySelectorAll('.add-btn').forEach(btn => {
    if (btn.dataset.category) {
        btn.addEventListener('click', (e) => {
            const category = e.target.dataset.category;
            const input = document.getElementById(`new-${category}`);
            if (input.value.trim()) {
                createTaskItem(category, input.value.trim());
                updateTasks(category, input.value.trim());
                input.value = '';
            }
        });
    }
});

function closeDayDetails() {
    elements.dayDetails.classList.remove('active');
    elements.calendar.classList.add('active');
    updateDashboard();
}

// Evento para o slider de tempo
elements.studyTime.addEventListener('input', function() {
    const minutes = parseInt(this.value);
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    elements.sliderValue.textContent = `${hours}h ${mins.toString().padStart(2, '0')}m`;
});

// Fun√ß√£o para Exportar Dados
function exportStudyData() {
    const exportData = {};
    // Captura todos os dados relevantes do localStorage
    for(let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if(key.startsWith('tasks-') || key.startsWith('sessions-') ||
            key === 'currentMonth' || key === 'currentYear' || key === 'customSubjects' ||
            key === 'weeklyGoal' || key === 'monthlyGoal' || key === 'examData') {
            exportData[key] = localStorage.getItem(key);
        }
    }
    // Cria e faz download do arquivo
    const dataStr = JSON.stringify(exportData, null, 2);
    const blob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `study_backup_${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Fun√ß√£o para Importar Dados
function importStudyData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedData = JSON.parse(e.target.result);
                // Limpa dados existentes relacionados ao app
                Object.keys(importedData).forEach(key => {
                    localStorage.removeItem(key);
                    localStorage.setItem(key, importedData[key]);
                });
                alert('Dados importados com sucesso! Atualize a p√°gina.');
            } catch (error) {
                alert('Erro na importa√ß√£o: Arquivo inv√°lido');
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// ==============================================
// FUN√á√ïES ADICIONAIS IMPLEMENTADAS (AGORA NO IN√çCIO PARA EVITAR ERROS)
// ==============================================
// 1. MARCA√á√ÉO DE DIAS CONCLU√çDOS NO CALEND√ÅRIO
function markCompletedDays() {
    const dateElements = document.querySelectorAll('.calendar-grid .date');
    
    dateElements.forEach(dateElement => {
        // Extrai a data do elemento
        const date = dateElement.getAttribute('data-date');
        if (!date) return;
        
        // Verifica se h√° sess√µes para esta data
        const sessions = JSON.parse(localStorage.getItem(`sessions-${date}`) || '[]');
        if (sessions.length > 0) {
            dateElement.classList.add('completed');
        } else {
            dateElement.classList.remove('completed');
        }
    });
}

// 2. FUN√á√ïES PARA EDI√á√ÉO DE DISCIPLINAS
function enableSubjectEdit(item, subject) {
    item.classList.add('edit-mode');
    const input = item.querySelector('.subject-edit-input');
    input.value = subject;
    input.focus();
}

function saveSubjectEdit(item, oldSubject) {
    const newSubject = item.querySelector('.subject-edit-input').value.trim();
    if (!newSubject) return;
    item.classList.remove('edit-mode');
    const subjectText = item.querySelector('.subject-text');
    subjectText.textContent = newSubject;
    
    // Atualiza no localStorage
    const subjects = JSON.parse(localStorage.getItem('customSubjects')) || [];
    const index = subjects.indexOf(oldSubject);
    if (index !== -1) {
        subjects[index] = newSubject;
        localStorage.setItem('customSubjects', JSON.stringify(subjects));
    }
    
    // Atualiza todas as refer√™ncias
    updateSubjectInSessions(oldSubject, newSubject);
    updateSubjectsDropdown();
    updateDashboard();
}

function updateSubjectInSessions(oldSubject, newSubject) {
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('sessions-')) {
            const sessions = JSON.parse(localStorage.getItem(key));
            const updatedSessions = sessions.map(session => {
                if (session.subject === oldSubject) {
                    return {...session, subject: newSubject};
                }
                return session;
            });
            localStorage.setItem(key, JSON.stringify(updatedSessions));
        }
    }
}

// 3. ATUALIZA√á√ÉO DA FUN√á√ÉO OPENSUBJECTSMODAL PARA ADICIONAR EDI√á√ÉO
function openSubjectsModal() {
    const subjects = JSON.parse(localStorage.getItem('customSubjects')) || [];
    elements.subjectListContainer.innerHTML = '';
    
    subjects.forEach(subject => {
        const div = document.createElement('div');
        div.className = 'subject-list-item';
        div.innerHTML = `
            <span class="subject-text">${subject}</span>
            <input type="text" class="subject-edit-input">
            <div class="subject-actions">
                <button class="subject-action-btn use" onclick="useSubject('${subject}')">
                    <i class="fas fa-check"></i>
                </button>
                <button class="subject-action-btn edit" onclick="enableSubjectEdit(this.parentElement.parentElement, '${subject}')">
                    <i class="fas fa-pen"></i>
                </button>
                <button class="subject-action-btn delete" onclick="deleteSubject('${subject}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        
        // Adiciona evento para salvar ao pressionar Enter
        const input = div.querySelector('.subject-edit-input');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveSubjectEdit(div, subject);
            }
        });
        
        // Adiciona evento para salvar ao perder o foco
        input.addEventListener('blur', () => {
            saveSubjectEdit(div, subject);
        });
        
        elements.subjectListContainer.appendChild(div);
    });
    
    elements.subjectsModal.classList.add('active');
}

function closeSubjectsModal() {
    elements.subjectsModal.classList.remove('active');
}

function useSubject(subject) {
    elements.studySubject.value = subject;
    closeSubjectsModal();
}

function deleteSubject(subject) {
    const subjects = JSON.parse(localStorage.getItem('customSubjects')) || [];
    const newSubjects = subjects.filter(s => s !== subject);
    localStorage.setItem('customSubjects', JSON.stringify(newSubjects));
    openSubjectsModal();
    updateSubjectsDropdown();
}

function addNewSubject() {
    const subject = elements.newSubject.value.trim();
    if (subject) {
        addCustomSubject(subject);
        elements.newSubject.value = '';
        openSubjectsModal();
    }
}

// Inicializa√ß√£o
function init() {
    renderCalendar(currentMonth, currentYear);
    updateDashboard();
    updateSubjectsDropdown();
    setupTimeButtons();
    checkSavedTheme();
    // Event listeners adicionais
    elements.themeToggle.addEventListener('click', toggleTheme);
    // Atualiza o slider ao carregar
    elements.studyTime.dispatchEvent(new Event('input'));
    // Marcar dias completos
    markCompletedDays();
    // Atualiza a contagem regressiva das provas
    updateExamCountdown();
}

// Executa a inicializa√ß√£o quando o documento estiver pronto
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
